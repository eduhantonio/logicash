{% extends 'base.html' %}

{% block title %}LogiCash | Perfil{% endblock %}

{% block content %}
<div class="main-content-profile fade-in-up">

    <!-- Cabeçalho do Perfil -->
    <div class="content-header">
        <div class="profile-header d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <div class="profile-avatar me-3">
                    <i class="fas fa-user-circle fa-4x text-light"></i>
                </div>
                <div>
                    <h2 class="welcome-title mb-1">{{ estudante.nome|default:user.username }}</h2>
                    <p class="text-secondary mb-0">{{ user.email }}</p>
                    <small class="text-secondary">Membro desde {{ user.date_joined|date:"F Y" }}</small>
                </div>
            </div>
            <div class="profile-stats d-flex gap-4">
                <div class="text-center">
                    <h3 class="mb-0">{{ pontuacao.pontos_totais|default:0 }}</h3>
                    <small>Pontos</small>
                </div>
                <div class="text-center">
                    <h3 class="mb-0">{{ pontuacao.nivel_atual|default:1 }}</h3>
                    <small>Nível</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Wrapper específico do perfil (corresponde ao CSS custom) -->
    <div class="profile-container">

        <!-- Formulário de Edição -->
        <div class="card profile-card">
            <div class="card-header profile-card-header d-flex align-items-center">
                <i class="fas fa-edit me-2"></i>
                <h5 class="mb-0">Editar Perfil</h5>
            </div>
            <div class="card-body profile-card-body">
                <form method="post" class="profile-form">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.nome.id_for_label }}" class="form-label profile-form-label">
                                <i class="fas fa-user me-1"></i> Nome Completo
                            </label>
                            {{ form.nome }}
                            {% for error in form.nome.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="{{ form.data_nascimento.id_for_label }}" class="form-label profile-form-label">
                                <i class="fas fa-birthday-cake me-1"></i> Data de Nascimento
                            </label>
                            {{ form.data_nascimento }}
                            {% for error in form.data_nascimento.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="{{ form.escola.id_for_label }}" class="form-label profile-form-label">
                                <i class="fas fa-school me-1"></i> Escola
                            </label>
                            {{ form.escola }}
                            {% for error in form.escola.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label for="{{ form.serie.id_for_label }}" class="form-label profile-form-label">
                                <i class="fas fa-calendar-alt me-1"></i> Série
                            </label>
                            {{ form.serie }}
                            {% for error in form.serie.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-flex flex-wrap gap-2 mt-3">
                        <button type="submit" class="btn btn-success profile-btn-save">
                            <i class="fas fa-save me-1"></i> Salvar Alterações
                        </button>
                        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary profile-btn-back">
                            <i class="fas fa-arrow-left me-1"></i> Voltar ao Dashboard
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Informações da Conta -->
        <div class="card profile-card">
            <div class="card-header profile-card-header d-flex align-items-center">
                <i class="fas fa-cog me-2"></i>
                <h5 class="mb-0">Informações da Conta</h5>
            </div>
            <div class="card-body profile-card-body">
                <div class="row gy-3">
                    <div class="col-md-6">
                        <div class="info-item p-3 rounded">
                            <label class="profile-info-label fw-bold">Nome de Usuário:</label>
                            <div class="profile-info-value">{{ user.username }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item p-3 rounded">
                            <label class="profile-info-label fw-bold">Email:</label>
                            <div class="profile-info-value">{{ user.email }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item p-3 rounded">
                            <label class="profile-info-label fw-bold">Último Login:</label>
                            <div class="profile-info-value">{{ user.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item p-3 rounded">
                            <label class="profile-info-label fw-bold">Data de Cadastro:</label>
                            <div class="profile-info-value">{{ user.date_joined|date:"d/m/Y" }}</div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 border-top pt-3">
                    <a href="{% url 'password_reset' %}" class="btn btn-outline-warning profile-btn-reset">
                        <i class="fas fa-key me-1"></i> Alterar Senha
                    </a>
                </div>
            </div>
        </div>

    </div> <!-- .profile-container -->

</div>
{% endblock %}